--DESCRIPCION
--===========
--PROCEDIMIENTO QUE PERMITE VISUALIZAR LA SITUACION DE CAJAS O PALETAS POR DIA DE PRODUCCION
--*@CAJA_O_PALETA= 1 MOSTRARA LA SITUACION DE LAS CAJAS POR DIA DE PRODUCCION
--*@CAJA_O_PALETA= 2 MOSTRARA LA SITUACION DE LAS PALETAS POR DIA DE PRODUCCION

CREATE PROCEDURE SP_reporte_situacion_cajas_o_paletas_creadas_por_dia_produccion
(
	@CAJA_O_PALETA INT,
	@RPTA INT
)
as
BEGIN
	IF (@CAJA_O_PALETA=1)
		BEGIN
			--REPORTE SITUACION CAJAS, POR DIA DE PRODUCCION
			SELECT DR.HORA_INICIO,DR.HORA_FIN,DR.ES_CERRADO AS DIA_CERRADO,V.NOMBRE AS VARIEDAD,E.NOMBRE AS EMPAQUE,COUNT(PT.ID_PRODUCTO_TERMINADO) AS CAJAS,
			CASE WHEN PT.ESTADO=0 THEN 'ACTIVA'
			WHEN PT.ESTADO=1 THEN 'EN PALETA'
			WHEN PT.ESTADO=3 THEN 'BAJA FRIO'
			WHEN PT.ESTADO=4 THEN 'CORTESIA'
			WHEN PT.ESTADO=6 THEN 'REEMPAQUE' 
			ELSE 'ERROR' END AS ESTADO
			FROM PRODUCTO_TERMINADO PT
			JOIN LOTE L ON PT.ID_LOTE=L.ID_LOTE
			JOIN CALIBRE CAL ON PT.ID_CALIBRE=CAL.ID_CALIBRE
			JOIN ENVASE E ON PT.ID_ENVASE=E.ID_ENVASE
			JOIN CATEGORIA CAT ON PT.ID_CATEGORIA=CAT.ID_CATEGORIA    
			JOIN VARIEDAD V ON L.ID_VARIEDAD=V.ID_VARIEDAD
			JOIN DIA_RECEPCION DR ON PT.ID_DIA_RECEPCION=DR.ID_DIA_RECEPCION
			GROUP BY DR.HORA_INICIO,DR.HORA_FIN,DR.ES_CERRADO,DR.ID_DIA_RECEPCION,PT.ESTADO,V.NOMBRE,E.NOMBRE ORDER BY DR.ID_DIA_RECEPCION DESC	
		END
	IF (@CAJA_O_PALETA=2)
	BEGIN
		--REPORTE SITUACION PALETAS, POR DIA DE PRODUCCION
		SELECT DR.HORA_INICIO,DR.HORA_FIN,DR.ES_CERRADO AS DIA_CERRADO,COUNT(PT.ID_PALETA) AS PALETAS,
		CASE WHEN PT.ESTADO_PALETA=1 THEN 'COMPLETA'
		WHEN PT.ESTADO_PALETA=2 THEN 'INCOMPLETA'
		WHEN PT.ESTADO_PALETA=3 THEN 'BAJA FRIO'
		WHEN PT.ESTADO_PALETA=4 THEN 'CORTESIA'
		WHEN PT.ESTADO_PALETA=5 THEN 'REPALETIZADA'
		WHEN PT.ESTADO_PALETA=6 THEN 'REEMPAQUE' END AS ESTADO
		FROM PALETA PT
		JOIN DIA_RECEPCION DR ON PT.ID_DIA_RECEPCION=DR.ID_DIA_RECEPCION
		GROUP BY DR.HORA_INICIO,DR.HORA_FIN,DR.ES_CERRADO,DR.ID_DIA_RECEPCION,PT.ESTADO_PALETA ORDER BY DR.ID_DIA_RECEPCION DESC	
	END
	SELECT @RPTA=1
END